<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>gganatogram</title>
<meta name="description" content="gganatogramhttps://github.com/jespermaag/gganatogram">

<link rel="stylesheet" href="/css/main.css">
<link rel="canonical" href="http://jespermaag.github.io/blog/2018/gganatogram/">
<link rel="alternate" type="application/rss+xml" title="Jesper Maag PhD" href="http://jespermaag.github.io/feed.xml" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <input type="checkbox" id="toggleNavbar">
    <nav class="navbar">
      <ul>
        <li><a href="/" title="Home">Home</a></li>
        
          <li><a href="/about" title="About">About</a></li>
        
          <li><a href="/education" title="Education">Education</a></li>
        
          <li><a href="/experience" title="Experience">Experience</a></li>
        
          <li><a href="/blog" title="Blog">Blog</a></li>
        
          <li><a href="/publications" title="Publications">Publications</a></li>
        
      </ul>
    </nav>
  </div>
</header>


<main class="main-container">
  <div class="container">
    <article role="article" class="post">

  <div class="card">
    <header class="post-header">
      <h1 class="post-title">gganatogram</h1>
      <em class="post-meta">
        <time>Sep 9, 2018</time>
      </em>
    </header>

    <div class="post-content">
      
        <figure class="post-thumbnail ">
          <img src="/assets/Rfig/organPlotAll-1.png" alt="gganatogram">
        </figure>
      
      <h1 id="gganatogram">gganatogram</h1>
<p><a href="https://github.com/jespermaag/gganatogram">https://github.com/jespermaag/gganatogram</a></p>

<p>Create anatogram images for different organisms.  <br />
For now only human male is available.  <br />. 
The idea for this package came to me after seeing a twitter post for <a href="https://github.com/LCBC-UiO/ggseg">ggseg</a>.
I thougt something similar would be good for whole organisms. 
Since I could not find anything similar, I deided to give creating my first R package a go.</p>

<p>This package uses the tissue coordinates from the figure in ArrayExpress Expression Atlas.  <br />
<a href="https://www.ebi.ac.uk/gxa/home">https://www.ebi.ac.uk/gxa/home</a>  <br />
<a href="https://github.com/ebi-gene-expression-group/anatomogram">https://github.com/ebi-gene-expression-group/anatomogram</a>  <br /></p>

<h2 id="generation-of-package">Generation of package</h2>

<h3 id="download-all-svg">Download all svg</h3>
<p>To create the package, I first had to retrive the coordinates of all tissues from the Expression Atlas. 
The anatogram package was downloaded using the following command.</p>
<pre><code>npm install --save anatomogram
</code></pre>

<h3 id="extract-coordinates-from-svg">Extract coordinates from svg</h3>
<p>I used python to extract the coordinates, names, and transformations for each tissue in the homo_sapiens.mal.svg file.
This code takes the svg and writes the name, coordinates, and transformation to a file, which is then processed in R.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="kn">from</span> <span class="nn">xml.dom</span> <span class="kn">import</span> <span class="n">minidom</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="n">organism</span><span class="o">=</span><span class="s2">&quot;homo_sapiens.male&quot;</span>
<span class="n">doc</span> <span class="o">=</span> <span class="n">minidom</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">organism</span> <span class="o">+</span> <span class="s2">&quot;.svg&quot;</span><span class="p">)</span>
<span class="n">your_csv_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">organism</span> <span class="o">+</span> <span class="s1">&#39;_coords.tsv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">wr</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">your_csv_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;outline&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;LAYER_OUTLINE&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">wr</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">path</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="p">,</span><span class="n">path</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;matrix(1,0,0,1,0,0)&#39;</span><span class="p">)])</span> 
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;UB&#39;</span><span class="p">):</span>
        <span class="n">wr</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">path</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">firstChild</span><span class="o">.</span><span class="n">nodeValue</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;matrix(1,0,0,1,0,0)&#39;</span><span class="p">)])</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">parentNode</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;UB&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;transform&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">parentNode</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
            <span class="n">wr</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">path</span><span class="o">.</span><span class="n">parentNode</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">getAttribute</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;matrix(1,0,0,1,0,0)&#39;</span><span class="p">)])</span>
<span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">:]:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">childNodes</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">childNodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;text&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">nodeName</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="k">if</span> <span class="s1">&#39;d&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> 
                    <span class="n">nodeVal</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
                    <span class="n">wr</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">path</span><span class="o">.</span><span class="n">childNodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">nodeVal</span><span class="p">,</span>  <span class="n">path</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;transform&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
<span class="n">your_csv_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></code></pre></figure>

<h3 id="process-the-coordinates-in-r-and-create-a-package">Process the coordinates in R, and create a package</h3>
<p>I created a function to extract the coordinates into a data frame and transformed the data. 
Some manual editing was required to get the right coordinates, and remove some tissues that did not work</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>extractCoords <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>coords<span class="p">,</span> name<span class="p">,</span> transMatrix<span class="p">)</span> <span class="p">{</span>
    <span class="kt">c</span> <span class="o">&lt;-</span> <span class="kp">strsplit</span><span class="p">(</span>coords<span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">)</span>
    <span class="kt">c</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span>

    <span class="kt">c</span><span class="p">[[</span><span class="m">1</span><span class="p">]][</span><span class="kt">c</span><span class="p">(</span><span class="kp">grep</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">,</span> <span class="kt">c</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span> <span class="p">)</span><span class="m">+1</span><span class="p">,</span><span class="kp">grep</span><span class="p">(</span><span class="s">&quot;M&quot;</span><span class="p">,</span> <span class="kt">c</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span> <span class="p">)</span><span class="m">+2</span><span class="p">)]</span> <span class="o">&lt;-</span> <span class="kc">NA</span>

    <span class="kt">c</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span> <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">[[</span><span class="m">1</span><span class="p">]][</span><span class="kp">grep</span><span class="p">(</span><span class="s">&quot;[[:alpha:]]&quot;</span><span class="p">,</span> <span class="kt">c</span><span class="p">[[</span><span class="m">1</span><span class="p">]],</span> invert<span class="o">=</span><span class="kc">TRUE</span><span class="p">)]</span>

    anatCoord <span class="o">&lt;-</span> <span class="kp">as.data.frame</span><span class="p">(</span><span class="kp">lapply</span><span class="p">(</span> <span class="kt">c</span><span class="p">,</span> <span class="kr">function</span><span class="p">(</span>u<span class="p">)</span> 
        <span class="kt">matrix</span><span class="p">(</span><span class="kp">as.numeric</span><span class="p">(</span><span class="kp">unlist</span><span class="p">(</span><span class="kp">strsplit</span><span class="p">(</span>u<span class="p">,</span> <span class="s">&quot;,&quot;</span><span class="p">))),</span>ncol<span class="o">=</span><span class="m">2</span><span class="p">,</span>byrow<span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> <span class="p">))</span>
    anatCoord<span class="o">$</span>X2<span class="p">[</span><span class="kp">is.na</span><span class="p">(</span>anatCoord<span class="o">$</span>X1<span class="p">)]</span> <span class="o">&lt;-</span> <span class="kc">NA</span>
    anatCoord<span class="o">$</span>X1<span class="p">[</span><span class="kp">is.na</span><span class="p">(</span>anatCoord<span class="o">$</span>X2<span class="p">)]</span> <span class="o">&lt;-</span> <span class="kc">NA</span>
    anatCoord<span class="o">$</span>id <span class="o">&lt;-</span> name

    <span class="kr">if</span> <span class="p">(</span><span class="kp">length</span><span class="p">(</span>transMatrix<span class="p">[</span><span class="kp">grep</span><span class="p">(</span><span class="s">&#39;matrix&#39;</span><span class="p">,</span> transMatrix<span class="p">)])</span><span class="o">&gt;</span><span class="m">0</span><span class="p">)</span> <span class="p">{</span>
        transForm <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#39;matrix\\(|\\)&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> transMatrix<span class="p">)</span>
        transForm <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span><span class="kp">strsplit</span><span class="p">(</span>transForm<span class="p">,</span> <span class="s">&quot;,&quot;</span><span class="p">)[[</span><span class="m">1</span><span class="p">]])</span>
       
        anatCoord<span class="o">$</span>x <span class="o">&lt;-</span>  <span class="p">(</span>anatCoord<span class="o">$</span>X1<span class="o">*</span> transForm<span class="p">[</span><span class="m">1</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span>anatCoord<span class="o">$</span>X1<span class="o">*</span> transForm<span class="p">[</span><span class="m">3</span><span class="p">])</span> <span class="o">+</span> transForm<span class="p">[</span><span class="m">5</span><span class="p">]</span>
        anatCoord<span class="o">$</span>y <span class="o">&lt;-</span>  <span class="p">(</span>anatCoord<span class="o">$</span>X2<span class="o">*</span> transForm<span class="p">[</span><span class="m">2</span><span class="p">])</span> <span class="o">+</span> <span class="p">(</span>anatCoord<span class="o">$</span>X2<span class="o">*</span> transForm<span class="p">[</span><span class="m">4</span><span class="p">])</span> <span class="o">+</span> transForm<span class="p">[</span><span class="m">6</span><span class="p">]</span>
    <span class="p">}</span> <span class="kr">else</span> <span class="kr">if</span> <span class="p">(</span><span class="kp">grep</span><span class="p">(</span><span class="s">&#39;translate&#39;</span><span class="p">,</span> transMatrix<span class="p">))</span> <span class="p">{</span>
        transForm <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#39;translate\\(|\\)&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> transMatrix<span class="p">)</span>
        transForm <span class="o">&lt;-</span> <span class="kp">as.numeric</span><span class="p">(</span><span class="kp">strsplit</span><span class="p">(</span>transForm<span class="p">,</span> <span class="s">&quot;,&quot;</span><span class="p">)[[</span><span class="m">1</span><span class="p">]])</span>
         <span class="kr">if</span><span class="p">(</span>name <span class="o">==</span><span class="s">&#39;leukocyte&#39;</span> <span class="o">&amp;</span> transForm<span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="o">==</span><span class="m">4.5230265</span><span class="p">)</span> <span class="p">{</span>
            transForm <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span><span class="m">103.63591+4.5230265</span><span class="p">,</span><span class="m">-47.577078+11.586659</span><span class="p">)</span>
        <span class="p">}</span>
        anatCoord<span class="o">$</span>x <span class="o">&lt;-</span>  anatCoord<span class="o">$</span>X1 <span class="o">+</span> transForm<span class="p">[</span><span class="m">1</span><span class="p">]</span>
        anatCoord<span class="o">$</span>y <span class="o">&lt;-</span>  anatCoord<span class="o">$</span>X2 <span class="o">+</span> transForm<span class="p">[</span><span class="m">2</span><span class="p">]</span>
    <span class="p">}</span>
    <span class="c1">#anatCoord &lt;- anatCoord[complete.cases(anatCoord),]</span>
    <span class="kr">if</span> <span class="p">(</span>name <span class="o">==</span> <span class="s">&#39;bronchus&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="kr">if</span> <span class="p">(</span><span class="kp">max</span><span class="p">(</span>anatCoord<span class="o">$</span>x<span class="p">,</span> na.rm<span class="o">=</span><span class="bp">T</span><span class="p">)</span> <span class="o">&gt;</span><span class="m">100</span> <span class="p">)</span> <span class="p">{</span>
            anatCoord<span class="o">$</span>x <span class="o">&lt;-</span> <span class="kc">NA</span>
            anatCoord<span class="o">$</span>y <span class="o">&lt;-</span> <span class="kc">NA</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kr">if</span><span class="p">(</span> <span class="kp">any</span><span class="p">(</span>anatCoord<span class="p">[</span>complete.cases<span class="p">(</span>anatCoord<span class="p">),]</span><span class="o">$</span>x <span class="o">&lt;</span> <span class="m">-5</span><span class="p">))</span> <span class="p">{</span>
            anatCoord<span class="o">$</span>x <span class="o">&lt;-</span> <span class="kc">NA</span>
            anatCoord<span class="o">$</span>y <span class="o">&lt;-</span> <span class="kc">NA</span>
    <span class="p">}</span>

    <span class="kr">if</span><span class="p">(</span> <span class="kp">any</span><span class="p">(</span>anatCoord<span class="p">[</span>complete.cases<span class="p">(</span>anatCoord<span class="p">),]</span><span class="o">$</span>x <span class="o">&gt;</span> <span class="m">150</span><span class="p">))</span> <span class="p">{</span>
            anatCoord<span class="o">$</span>x <span class="o">&lt;-</span> <span class="kc">NA</span>
            anatCoord<span class="o">$</span>y <span class="o">&lt;-</span> <span class="kc">NA</span>
    <span class="p">}</span>
    <span class="kr">return</span><span class="p">(</span>anatCoord<span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>Finally, I processed the python output using the extractCoords function.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>hsMale <span class="o">&lt;-</span> read.table<span class="p">(</span><span class="s">&#39;homo_sapiens.male_coords.tsv&#39;</span><span class="p">,</span> sep<span class="o">=</span><span class="s">&#39;\t&#39;</span><span class="p">,</span> stringsAsFactors<span class="o">=</span><span class="bp">F</span><span class="p">)</span>

hgMale_list <span class="o">&lt;-</span> <span class="kt">list</span><span class="p">()</span>
<span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span><span class="kp">nrow</span><span class="p">(</span>hsMale<span class="p">))</span> <span class="p">{</span>
    df <span class="o">&lt;-</span> extractCoords<span class="p">(</span>hsMale<span class="o">$</span>V2<span class="p">[</span>i<span class="p">],</span> hsMale<span class="o">$</span>V1<span class="p">[</span>i<span class="p">],</span>  hsMale<span class="o">$</span>V3<span class="p">[</span>i<span class="p">])</span>

    hgMale_list<span class="p">[[</span>i<span class="p">]]</span> <span class="o">&lt;-</span> extractCoords<span class="p">(</span>hsMale<span class="o">$</span>V2<span class="p">[</span>i<span class="p">],</span> hsMale<span class="o">$</span>V1<span class="p">[</span>i<span class="p">],</span>  hsMale<span class="o">$</span>V3<span class="p">[</span>i<span class="p">])</span>
    <span class="kp">names</span><span class="p">(</span>hgMale_list<span class="p">)[</span>i<span class="p">]</span> <span class="o">&lt;-</span>  <span class="kp">paste0</span><span class="p">(</span>hsMale<span class="o">$</span>V1<span class="p">[</span>i<span class="p">],</span><span class="s">&#39;-&#39;</span><span class="p">,</span> i<span class="p">)</span>
<span class="p">}</span>
<span class="kp">names</span><span class="p">(</span>hgMale_list<span class="p">)</span> <span class="o">&lt;-</span> <span class="kp">gsub</span><span class="p">(</span><span class="s">&#39;-.*&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="kp">names</span><span class="p">(</span>hgMale_list<span class="p">))</span></code></pre></figure>

<p>The resulting list was then used as the base for the gganatogram package. 
The package can be installed from github using the instructions below.</p>

<h2 id="install">Install</h2>

<p>Install from github using devtools.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span><span class="c1">## install from Github</span>
devtools<span class="o">::</span>install_github<span class="p">(</span><span class="s">&quot;jespermaag/gganatogram&quot;</span><span class="p">)</span></code></pre></figure>

<h2 id="usage">Usage</h2>

<p>This package requires <code>ggplot2</code> and <code>ggpolypath</code></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>ggpolypath<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>gganatogram<span class="p">)</span>
<span class="kn">library</span><span class="p">(</span>dplyr<span class="p">)</span></code></pre></figure>

<p>In order to use the function gganatogram, you need to have a data frame with
organ, colour, and value if you want to.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>organPlot <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span>organ <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;heart&quot;</span><span class="p">,</span> <span class="s">&quot;leukocyte&quot;</span><span class="p">,</span> <span class="s">&quot;nerve&quot;</span><span class="p">,</span> <span class="s">&quot;brain&quot;</span><span class="p">,</span> <span class="s">&quot;liver&quot;</span><span class="p">,</span> <span class="s">&quot;stomach&quot;</span><span class="p">,</span> <span class="s">&quot;colon&quot;</span><span class="p">),</span> 
 type <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;circulation&quot;</span><span class="p">,</span> <span class="s">&quot;circulation&quot;</span><span class="p">,</span>  <span class="s">&quot;nervous system&quot;</span><span class="p">,</span> <span class="s">&quot;nervous system&quot;</span><span class="p">,</span> <span class="s">&quot;digestion&quot;</span><span class="p">,</span> <span class="s">&quot;digestion&quot;</span><span class="p">,</span> <span class="s">&quot;digestion&quot;</span><span class="p">),</span> 
 colour <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;purple&quot;</span><span class="p">,</span> <span class="s">&quot;purple&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">),</span> 
 value <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> 
 stringsAsFactors<span class="o">=</span><span class="bp">F</span><span class="p">)</span>

<span class="kp">head</span><span class="p">(</span>organPlot<span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>##       organ           type colour value
## 1     heart    circulation    red    10
## 2 leukocyte    circulation    red     5
## 3     nerve nervous system purple     1
## 4     brain nervous system purple     8
## 5     liver      digestion orange     2
## 6   stomach      digestion orange     5</code></pre></figure>

<p>Using the function gganatogram with the filling the organs based on colour.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>gganatogram<span class="p">(</span>data<span class="o">=</span>organPlot<span class="p">,</span> fillOutline<span class="o">=</span><span class="s">&#39;#a6bddb&#39;</span><span class="p">,</span> organism<span class="o">=</span><span class="s">&#39;human&#39;</span><span class="p">,</span> sex<span class="o">=</span><span class="s">&#39;male&#39;</span><span class="p">,</span> fill<span class="o">=</span><span class="s">&quot;colour&quot;</span><span class="p">)</span></code></pre></figure>

<p><img src="/assets/Rfig/organPlot-1.svg" alt="plot of chunk organPlot" /></p>

<p>We can use the ggplot themes and functions to adjust the plots</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>gganatogram<span class="p">(</span>data<span class="o">=</span>organPlot<span class="p">,</span> fillOutline<span class="o">=</span><span class="s">&#39;#a6bddb&#39;</span><span class="p">,</span> organism<span class="o">=</span><span class="s">&#39;human&#39;</span><span class="p">,</span> sex<span class="o">=</span><span class="s">&#39;male&#39;</span><span class="p">,</span> fill<span class="o">=</span><span class="s">&quot;colour&quot;</span><span class="p">)</span> <span class="o">+</span> 
theme_void<span class="p">()</span></code></pre></figure>

<p><img src="/assets/Rfig/organPlotvoid-1.svg" alt="plot of chunk organPlotvoid" /></p>

<p>We can also plot all tissues available using hgMale_key, which is an available object</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>hgMale_key<span class="o">$</span>organ</code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text"><span></span>##  [1] &quot;bone marrow&quot;               &quot;frontal cortex&quot;           
##  [3] &quot;prefrontal cortex&quot;         &quot;gastroesophageal junction&quot;
##  [5] &quot;caecum&quot;                    &quot;ileum&quot;                    
##  [7] &quot;rectum&quot;                    &quot;nose&quot;                     
##  [9] &quot;tongue&quot;                    &quot;penis&quot;                    
## [11] &quot;nasal pharynx&quot;             &quot;spinal cord&quot;              
## [13] &quot;throat&quot;                    &quot;diaphragm&quot;                
## [15] &quot;liver&quot;                     &quot;stomach&quot;                  
## [17] &quot;spleen&quot;                    &quot;duodenum&quot;                 
## [19] &quot;gall bladder&quot;              &quot;pancreas&quot;                 
## [21] &quot;colon&quot;                     &quot;small intestine&quot;          
## [23] &quot;appendix&quot;                  &quot;urinary bladder&quot;          
## [25] &quot;bone&quot;                      &quot;cartilage&quot;                
## [27] &quot;esophagus&quot;                 &quot;skin&quot;                     
## [29] &quot;brain&quot;                     &quot;heart&quot;                    
## [31] &quot;lymph_node&quot;                &quot;skeletal_muscle&quot;          
## [33] &quot;leukocyte&quot;                 &quot;temporal_lobe&quot;            
## [35] &quot;atrial_appendage&quot;          &quot;coronary_artery&quot;          
## [37] &quot;hippocampus&quot;               &quot;vas_deferens&quot;             
## [39] &quot;seminal_vesicle&quot;           &quot;epididymis&quot;               
## [41] &quot;tonsil&quot;                    &quot;lung&quot;                     
## [43] &quot;trachea&quot;                   &quot;bronchus&quot;                 
## [45] &quot;nerve&quot;                     &quot;kidney&quot;</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>gganatogram<span class="p">(</span>data<span class="o">=</span>hgMale_key<span class="p">,</span> fillOutline<span class="o">=</span><span class="s">&#39;#a6bddb&#39;</span><span class="p">,</span> organism<span class="o">=</span><span class="s">&#39;human&#39;</span><span class="p">,</span> sex<span class="o">=</span><span class="s">&#39;male&#39;</span><span class="p">,</span> fill<span class="o">=</span><span class="s">&quot;colour&quot;</span><span class="p">)</span> <span class="o">+</span>theme_void<span class="p">()</span></code></pre></figure>

<p><img src="/assets/Rfig/organPlotAll-1.svg" alt="plot of chunk organPlotAll" /></p>

<p>To skip the outline of the graph, use outline=F</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>organPlot <span class="o">%&gt;%</span>
    dplyr<span class="o">::</span>filter<span class="p">(</span>type <span class="o">%in%</span> <span class="kt">c</span><span class="p">(</span><span class="s">&#39;circulation&#39;</span><span class="p">,</span> <span class="s">&#39;nervous system&#39;</span><span class="p">))</span> <span class="o">%&gt;%</span>
gganatogram<span class="p">(</span>outline<span class="o">=</span><span class="bp">F</span><span class="p">,</span> fillOutline<span class="o">=</span><span class="s">&#39;#a6bddb&#39;</span><span class="p">,</span> organism<span class="o">=</span><span class="s">&#39;human&#39;</span><span class="p">,</span> sex<span class="o">=</span><span class="s">&#39;male&#39;</span><span class="p">,</span> fill<span class="o">=</span><span class="s">&quot;colour&quot;</span><span class="p">)</span> <span class="o">+</span> 
theme_void<span class="p">()</span></code></pre></figure>

<p><img src="/assets/Rfig/organPlotSubset-1.svg" alt="plot of chunk organPlotSubset" /></p>

<p>We can fill the tissues based on the values given to each organ</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>gganatogram<span class="p">(</span>data<span class="o">=</span>organPlot<span class="p">,</span> fillOutline<span class="o">=</span><span class="s">&#39;#a6bddb&#39;</span><span class="p">,</span> organism<span class="o">=</span><span class="s">&#39;human&#39;</span><span class="p">,</span> sex<span class="o">=</span><span class="s">&#39;male&#39;</span><span class="p">,</span> fill<span class="o">=</span><span class="s">&quot;value&quot;</span><span class="p">)</span> <span class="o">+</span> 
theme_void<span class="p">()</span> <span class="o">+</span>
scale_fill_gradient<span class="p">(</span>low <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">,</span> high <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">)</span></code></pre></figure>

<p><img src="/assets/Rfig/organPlotValue-1.svg" alt="plot of chunk organPlotValue" /></p>

<p>We can also use facet_wrap to compare groups.<br />
 First create add two data frames together with different values and the conditions in the type column</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>compareGroups <span class="o">&lt;-</span> <span class="kp">rbind</span><span class="p">(</span><span class="kt">data.frame</span><span class="p">(</span>organ <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;heart&quot;</span><span class="p">,</span> <span class="s">&quot;leukocyte&quot;</span><span class="p">,</span> <span class="s">&quot;nerve&quot;</span><span class="p">,</span> <span class="s">&quot;brain&quot;</span><span class="p">,</span> <span class="s">&quot;liver&quot;</span><span class="p">,</span> <span class="s">&quot;stomach&quot;</span><span class="p">,</span> <span class="s">&quot;colon&quot;</span><span class="p">),</span> 
  colour <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;purple&quot;</span><span class="p">,</span> <span class="s">&quot;purple&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">),</span> 
 value <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> 
 type <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="s">&#39;Normal&#39;</span><span class="p">,</span> <span class="m">7</span><span class="p">),</span> 
 stringsAsFactors<span class="o">=</span><span class="bp">F</span><span class="p">),</span>
 <span class="kt">data.frame</span><span class="p">(</span>organ <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;heart&quot;</span><span class="p">,</span> <span class="s">&quot;leukocyte&quot;</span><span class="p">,</span> <span class="s">&quot;nerve&quot;</span><span class="p">,</span> <span class="s">&quot;brain&quot;</span><span class="p">,</span> <span class="s">&quot;liver&quot;</span><span class="p">,</span> <span class="s">&quot;stomach&quot;</span><span class="p">,</span> <span class="s">&quot;colon&quot;</span><span class="p">),</span> 
  colour <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;purple&quot;</span><span class="p">,</span> <span class="s">&quot;purple&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">,</span> <span class="s">&quot;orange&quot;</span><span class="p">),</span> 
 value <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">5</span><span class="p">),</span> 
 type <span class="o">=</span> <span class="kp">rep</span><span class="p">(</span><span class="s">&#39;Cancer&#39;</span><span class="p">,</span> <span class="m">7</span><span class="p">),</span> 
 stringsAsFactors<span class="o">=</span><span class="bp">F</span><span class="p">))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>gganatogram<span class="p">(</span>data<span class="o">=</span>compareGroups<span class="p">,</span> fillOutline<span class="o">=</span><span class="s">&#39;#a6bddb&#39;</span><span class="p">,</span> organism<span class="o">=</span><span class="s">&#39;human&#39;</span><span class="p">,</span> sex<span class="o">=</span><span class="s">&#39;male&#39;</span><span class="p">,</span> fill<span class="o">=</span><span class="s">&quot;value&quot;</span><span class="p">)</span> <span class="o">+</span> 
    theme_void<span class="p">()</span> <span class="o">+</span>
    facet_wrap<span class="p">(</span><span class="o">~</span>type<span class="p">)</span> <span class="o">+</span>
    scale_fill_gradient<span class="p">(</span>low <span class="o">=</span> <span class="s">&quot;white&quot;</span><span class="p">,</span> high <span class="o">=</span> <span class="s">&quot;red&quot;</span><span class="p">)</span> </code></pre></figure>

<p><img src="/assets/Rfig/Condition-1.svg" alt="plot of chunk Condition" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>gganatogram<span class="p">(</span>data<span class="o">=</span>hgMale_key<span class="p">,</span> fillOutline<span class="o">=</span><span class="s">&#39;#a6bddb&#39;</span><span class="p">,</span> organism<span class="o">=</span><span class="s">&#39;human&#39;</span><span class="p">,</span> sex<span class="o">=</span><span class="s">&#39;male&#39;</span><span class="p">,</span> fill<span class="o">=</span><span class="s">&quot;colour&quot;</span><span class="p">)</span> <span class="o">+</span>
    theme_void<span class="p">()</span> <span class="o">+</span>
    facet_wrap<span class="p">(</span><span class="o">~</span>type<span class="p">)</span></code></pre></figure>

<p><img src="/assets/Rfig/organPlotAllWrap-1.svg" alt="plot of chunk organPlotAllWrap" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>gganatogram<span class="p">(</span>data<span class="o">=</span>hgMale_key<span class="p">,</span> outline<span class="o">=</span><span class="bp">F</span><span class="p">,</span> fillOutline<span class="o">=</span><span class="s">&#39;#a6bddb&#39;</span><span class="p">,</span> organism<span class="o">=</span><span class="s">&#39;human&#39;</span><span class="p">,</span> sex<span class="o">=</span><span class="s">&#39;male&#39;</span><span class="p">,</span> fill<span class="o">=</span><span class="s">&quot;colour&quot;</span><span class="p">)</span> <span class="o">+</span>
    theme_void<span class="p">()</span> <span class="o">+</span>
    facet_wrap<span class="p">(</span><span class="o">~</span>type<span class="p">,</span> scale<span class="o">=</span><span class="s">&#39;free&#39;</span><span class="p">)</span></code></pre></figure>

<p><img src="/assets/Rfig/organPlotAllWrapFree-1.svg" alt="plot of chunk organPlotAllWrapFree" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span></span>organtype <span class="o">&lt;-</span> organPlot
organtype <span class="o">%&gt;%</span>
    mutate<span class="p">(</span>type<span class="o">=</span>organ<span class="p">)</span> <span class="o">%&gt;%</span>
    gganatogram<span class="p">(</span> outline<span class="o">=</span><span class="bp">F</span><span class="p">,</span> fillOutline<span class="o">=</span><span class="s">&#39;#a6bddb&#39;</span><span class="p">,</span> organism<span class="o">=</span><span class="s">&#39;human&#39;</span><span class="p">,</span> sex<span class="o">=</span><span class="s">&#39;male&#39;</span><span class="p">,</span> fill<span class="o">=</span><span class="s">&quot;colour&quot;</span><span class="p">)</span> <span class="o">+</span>
        theme_void<span class="p">()</span> <span class="o">+</span>
        facet_wrap<span class="p">(</span><span class="o">~</span>type<span class="p">,</span> scale<span class="o">=</span><span class="s">&#39;free&#39;</span><span class="p">)</span></code></pre></figure>

<p><img src="/assets/Rfig/organPlotWrapFree-1.svg" alt="plot of chunk organPlotWrapFree" /></p>


    </div>

    

  </div>

</article>

  </div>
</main>

<footer class="site-footer">
  <div class="container">
    <ul class="social">
  <li><a href="https://github.com/jespermaag" target="_blank"><i class="icon icon-github"></i></a></li>
  <li><a href="https://twitter.com/jespermaag" target="_blank"><i class="icon icon-twitter"></i></a></li>
  <li><a href="https://linkedin.com/in/jesper-maag" target="_blank"><i class="icon icon-linkedin"></i></a></li>
</ul>
    <p class="txt-medium-gray">
      <small>&copy;2020 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


  <a href="http://jespermaag.github.io" target="_blank" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#337ab7; color:#fff; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
</body>
</html>
